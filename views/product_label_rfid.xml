<?xml version="1.0" encoding="utf-8"?>
<!--
    Copyright 2025 Aurora Tech Group LTD, London, UK
    Developer: Andrew
    License LGPL-3.0 or later (https://www.gnu.org/licenses/lgpl-3.0).
-->
<odoo>
    <!-- 
        Override the default stock product label template to add RFID encoding.
        
        This template inherits from stock.label_product_product_view and adds
        the ^RFW (RFID Write) ZPL command to encode the EPC into the RFID chip.
        
        ZPL Commands Used:
        - ^RFW: RFID Write command
        - H: EPC Memory Bank (High-frequency/UHF)
        - ^FD...^FS: Field Data (contains the EPC hexadecimal code)
        
        The EPC is generated dynamically by calling product.generate_sgtin96_epc()
        which returns a 24-character hexadecimal SGTIN-96 code.
        
        Developed by Aurora Tech Group LTD, London, UK
        Developer: Andrew
        Website: https://auroratechgroup.co.uk
        Support: info@auroratechgroup.co.uk
    -->
    <template id="label_product_rfid_auto" inherit_id="stock.label_product_product_view">
        <xpath expr="//t[@t-translation='off']" position="replace">
            <t t-translation="off">
                <!-- Generate unique EPC for this label -->
                <t t-set="epc_code" t-value="product.generate_sgtin96_epc(barcode, qty)"/>
                
                <!-- ZPL Template for Zebra RFID Printer -->
                <!-- Label Size: 609 dots width x 200 dots height (approx 3" x 1") -->
                <!-- Developed by Aurora Tech Group LTD, London, UK -->
^XA
<!-- Printer Configuration -->
^RW28           <!-- RFID Write Power: 28 dBm (adjust 26-30 as needed) -->
^RS8            <!-- RFID Read Power: 8 dBm -->
^RZ2,1          <!-- RFID Position: 2 dots from edge, verify 1 time -->
^RT10,10        <!-- RFID Retry: 10 attempts, 10ms delay -->
^CI28           <!-- Character Set: UTF-8 -->

<!-- Label Setup -->
^PW609          <!-- Print Width: 609 dots -->
^LL200          <!-- Label Length: 200 dots -->
^LH0,0          <!-- Label Home: 0,0 -->
^LS0            <!-- Label Shift: 0 -->

<!-- Barcode (Code 128) -->
^FO150,10^BY2.4
^BCN,80,N,N,N   <!-- Code 128, height 80, no text above, no text below, no check digit -->
^FD<t t-out="barcode"/>^FS

<!-- Barcode Text (Human-Readable) -->
^FO200,95
^A0N,18,15^FD<t t-out="barcode"/>^FS

<!-- Product Name -->
^FO25,120
^A0N,22,18^FD<t t-out="product.display_name"/>^FS

<!-- RFID Encoding -->
<!-- CRITICAL: This line writes the EPC to the RFID chip -->
<!-- Format: ^RFW,H^FD<24-char-hex-EPC>^FS -->
<!-- H = EPC Memory Bank (High-frequency UHF) -->
<!-- Aurora Tech Group LTD - Automatic EPC Generation -->
^RFW,H^FD<t t-out="epc_code"/>^FS

^XZ
            </t>
        </xpath>
    </template>
</odoo>
